---
layout:     post
title:      Hbase笔记
subtitle:   Hbase笔记
date:       2021-10-10
author:     AnAn
header-img: /img/post-bg-article.jpg
catalog: true
tags:
    - Hbase
    - Hadoop
---

### 介绍
以下学习笔记来自于尚硅谷的Hbase课程

### 目录
- [前言](#前言)
- [habse写数据](#habse写数据)
- [Hbase部署](#Hbase部署)


<a name="前言"></a>
### 前言
<a style="position:relative;">![hbase架构](/img/post/hbase-note/2021-10-12_15-13.png)</a>
- HMaster 记录元数据，管理表（DDL），DML任务分发给RegionServer
- HRegionServer 处理增删改查（DML)
- HRegion 一张表占用一个或多个HRegion，一个HRegion只从属于一张表
- Store对应一个列族
- StoreFile
    保存实际数据的物理文件， StoreFile 以 HFile 的形式存储在 HDFS 上。每个 Store 会有
    一个或多个 StoreFile（HFile），数据在每个 StoreFile 中都是有序的。
- MemStore
    写缓存， 由于 HFile 中的数据要求是有序的， 所以数据是先存储在 MemStore 中，排好序后，等到达刷写时机才会刷写到 HFile，每次刷写都会形成一个新的 HFile。
- WAL(Hlog 预写入日志，文件对应写入预写入缓存MemStore)
    由于数据要经 MemStore 排序后才能刷写到 HFile， 但把数据保存在内存中会有很高的
    概率导致数据丢失，为了解决这个问题，数据会先写在一个叫做 Write-Ahead logfile 的文件
    中，然后再写入 MemStore 中。所以在系统出现故障的时候，数据可以通过这个日志文件重
    建。
- Hbase客户端在读写数据时直接与ZK和RegionServer交互
- **Hbase是一个读比写慢的框架**  

<a name="habse写数据"></a>
### habse写数据
- put NSP:Stu,rowkey:0001,name:张三  
1. 向ZK请求hbase:meta表的位置（一个HregionServer，代号HR1）
2. 在HR1查找维护NSP:Stu表的HregionServer位置，代号HR2
3. 在HR2中存储数据，HR2存储成功后返回ACK  


<a name="MemStore刷写时机"></a>
### MemStore刷写时机  
1. 当某个 memstroe 的大小达到了 hbase.hregion.memstore.flush.size（默认值 128M） ，
其所在 region 的所有 memstore 都会刷写。
当 memstore 的大小达到了
hbase.hregion.memstore.flush.size（默认值 128M），hbase.hregion.memstore.block.multiplier（默认值 4）
时，会阻止继续往该 memstore 写数据。
2.  region server 中 memstore 的总大小达到
java_heapsize
*hbase.regionserver.global.memstore.size（默认值 0.4）
*hbase.regionserver.global.memstore.size.lower.limit（默认值 0.95） ，
region 会按照其所有 memstore 的大小顺序（由大到小）依次进行刷写。直到 region server
中所有 memstore 的总大小减小到上述值以下。
当 region server 中 memstore 的总大小达到
java_heapsize*hbase.regionserver.global.memstore.size（默认值 0.4）
时，会阻止继续往所有的 memstore 写数据。
3. 到达自动刷写的时间，也会触发 memstore flush。自动刷新的时间间隔由该属性进行
配置 hbase.regionserver.optionalcacheflushinterval（默认 1 小时） 。尚硅谷大数据技术之 Hbase  
4. 当 WAL 文件的数量超过 hbase.regionserver.max.logs， region 会按照时间顺序依次进
行刷写，直到 WAL 文件数量减小到 hbase.regionserver.max.log 以下（该属性名已经废弃，
现无需手动设置， 最大值为 32）


###hbase读数据  

![hbase架构](/img/post/hbase-note/2021-10-12_15-14.png)



